<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="payment">
	<select id="pointlist" parameterType="map" resultType="dto.PointDTO">
		select b.*
		from (select rownum rm, a.*
			from (select p.*, u.user_nickname
				from moons_point p, moons_user u
				where (p.point_donater=#{user_code} and u.user_code=p.point_receiver) or (p.point_receiver=#{user_code} and u.user_code=p.point_donater)
				order by point_date desc)a)b
		<![CDATA[where rm>#{start} and rm<=#{start}+8]]>
	</select>
	
	<select id="selPoint" parameterType="int" resultType="int">
		select user_point
		from moons_user
		where user_code=#{user_code}
	</select>
	
	<insert id="donate" parameterType="dto.PointDTO">
		insert into moons_point values(moons_point_num_seq.nextval,#{point_donater},#{point_receiver},#{point_donate},sysdate)
	</insert> 
	
	<insert id="charge" parameterType="dto.PaymentDTO">
		insert into moons_payment values(moons_payment_num_seq.nextval,#{user_code},#{payment_deposit},0,sysdate)
	</insert>
</mapper> 