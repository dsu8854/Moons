<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	<resultMap id="boardContent" type="dto.BoardDTO" >
    	<result property="board_content" column="board_content" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>

	<select id="sel" resultType="dto.BoardDTO" resultMap="boardContent" parameterType="dto.UserDTO">
		select board_num, m.user_code, board_movie, board_subject, board_content, board_like, board_share, board_reply,
		to_char(board_date, 'YYYY-MM-DD HH24:MI:SS') as board_date, board_hashtag,
		user_nickname, user_photo,
		(select case when count(*) > 0 then 1 else 0 end 
        from moons_like
		where user_code=#{user_code} and board_num=m.board_num) as isLike,
		(select case when count(*) > 0 then 1 else 0 end 
        from moons_share
		where user_code=#{user_code} and board_num=m.board_num) as isShare
		from moons_board m, moons_user u
		where m.user_code in (select follow_following from moons_follow where user_code=#{user_code}) and m.user_code=u.user_code
		order by board_date desc		
	</select>
	
	<select id="selLike" parameterType="dto.BoardDTO" resultType="int">
		select count(*) from moons_like where board_num=#{board_num}
	</select>
	
	<insert id="insLike" parameterType="dto.BoardDTO">
		insert into moons_like values(#{user_code},#{board_num},SYSDATE)
	</insert>
	
	<delete id="delLike" parameterType="dto.BoardDTO">
		delete from moons_like where user_code=#{user_code} and board_num=#{board_num}
	</delete>
	
	<select id="selShare" parameterType="dto.BoardDTO" resultType="int">
		select count(*) from moons_share where board_num=#{board_num}
	</select>
	
	<insert id="insShare" parameterType="dto.BoardDTO">
		insert into moons_share values(#{user_code},#{board_num},SYSDATE)
	</insert>
	
	<delete id="delShare" parameterType="dto.BoardDTO">
		delete from moons_share where user_code=#{user_code} and board_num=#{board_num}
	</delete>
	
	<insert id="insImg" parameterType="dto.EditorImageDTO">
		insert into editor_image values(imageUP_seq.nextval,#{content_type},#{file_name},#{file_path},sysdate,#{save_file_name},#{img_size})
	</insert>
	
	<insert id="ins" parameterType="dto.BoardDTO">
		insert into moons_board values(moons_board_num_seq.nextval,'123','movie',#{board_subject},#{board_content},0,0,sysdate,#{board_hashtag})
	</insert>
	
	<select id="selOne" parameterType="dto.BoardDTO" resultType="dto.BoardDTO">
		select * from moons_board where board_num=#{board_num}
	</select>
	
	<select id="selWriter" parameterType="dto.BoardDTO" resultType="int">
		select user_code from moons_board where board_num=#{board_num}
	</select>
</mapper>   